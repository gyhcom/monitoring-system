# 🚀 Kafka와 Redis의 역할 및 필요성

이 문서는 **Kafka와 Redis가 이 시스템에서 각각 어떤 역할을 수행하는지**,  
그리고 **왜 Kafka와 Redis를 함께 사용해야 하는지**를 설명합니다.

---

## 🎯 **Kafka의 역할: 장애 이벤트 메시징 (비동기 데이터 흐름)**
Kafka는 **비동기 이벤트 기반 메시징 시스템**으로 동작하며, **장애 이벤트를 발행하고 전달하는 역할**을 합니다.

### 📌 Kafka가 하는 일
1. **장애 발생 시 이벤트 발행 (Producer)**
    - `HealthCheckProducer`가 장애 이벤트를 Kafka의 `health-alerts` 토픽에 발행
    - 예: `"ALERT: Server-1 is DOWN!"` 메시지를 Kafka에 보냄

2. **장애 이벤트 수신 및 처리 (Consumer)**
    - `HealthAlertConsumer`가 `health-alerts` 토픽을 구독하여 장애 이벤트 수신 (`@KafkaListener`)
    - 수신된 이벤트를 필터링 (`DOWN` 포함 여부 확인)
    - 장애 이벤트를 **Redis에 저장** (`saveHealthStatus()`)
    - 장애 이벤트를 **실시간으로 Redis Pub/Sub을 통해 전달 가능** (`publishHealthStatus()`)

---

## 🔥 **Redis의 역할: 장애 상태 저장 및 실시간 알림**
Redis는 **빠른 데이터 접근과 실시간 알림(Pub/Sub) 기능**을 담당합니다.

### 📌 Redis가 하는 일
1. **장애 상태 저장 (Key-Value Store)**
    - Kafka에서 받은 장애 이벤트를 Redis에 Key-Value 형태로 저장 (`saveHealthStatus()`)
    - 예: `"server-health:Server-1" → "DOWN"` 형태로 저장
    - 특정 서버의 장애 상태를 빠르게 조회할 수 있음

2. **장애 상태 실시간 알림 (Pub/Sub)**
    - `publishHealthStatus()`를 통해 장애 상태를 Redis **Pub/Sub 채널**에 전송
    - 장애 감지 시 **대시보드 또는 다른 시스템이 즉시 구독하여 반응 가능**

---

## 🏗 **Kafka와 Redis의 관계**
| 역할 | Kafka | Redis |
|------|------|------|
| **비동기 메시징 (장애 이벤트 전파)** | ✅ 장애 이벤트 발행 & 수신 | ❌ 사용 안 함 |
| **장애 이벤트 저장 (조회 가능)** | ❌ 사용 안 함 | ✅ Key-Value 저장 |
| **장애 이벤트 실시간 알림** | ❌ 사용 안 함 | ✅ Pub/Sub 활용 |
| **대량 이벤트 처리 (확장 가능)** | ✅ 고속 메시징 큐 | ❌ |
| **빠른 데이터 조회 (단일 장애 상태 확인)** | ❌ | ✅ |

---

## ✅ **Kafka와 Redis를 같이 사용하는 이유**
✔ **Kafka**는 **장애 이벤트의 메시징**을 담당하고, **이벤트를 여러 서비스가 비동기적으로 처리할 수 있도록 함**  
✔ **Redis**는 **빠른 장애 상태 저장 및 실시간 알림**을 담당하여 **장애 상태를 조회하거나 대시보드에서 확인 가능**  
✔ **Kafka는 장애 이벤트의 흐름을 관리하고, Redis는 현재 장애 상태를 관리하는 역할을 수행**

---

## 🚀 **Kafka 없이 Redis만 사용하면?**
✔ 장애 이벤트를 Redis에 직접 저장할 수 있지만, **장애 이벤트가 많아지면 부담이 큼**  
✔ 장애 이벤트를 **이벤트 기반으로 여러 서비스에서 처리하려면 Kafka가 필요**  
✔ **Kafka는 "이벤트 흐름 관리", Redis는 "장애 상태 저장 및 알림"**

---

## 🚀 **Redis 없이 Kafka만 사용하면?**
✔ Kafka에서 장애 이벤트를 발행하고, Consumer에서 바로 처리할 수 있지만, **실시간 장애 상태 조회가 어려움**  
✔ 장애 상태를 저장하려면 별도의 데이터베이스(MySQL, PostgreSQL 등)를 추가해야 함  
✔ **Redis는 빠른 데이터 조회와 Pub/Sub을 통한 실시간 장애 알림이 가능**

---

## ✅ **결론**
### 🔹 Kafka → 장애 이벤트의 흐름을 관리 (장애 감지 및 비동기 메시징)
### 🔹 Redis → 장애 상태를 저장하고, 실시간 알림 전송 (빠른 조회 및 대시보드 활용)
